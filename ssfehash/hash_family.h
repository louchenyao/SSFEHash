#pragma once

#include <tuple>

const int HASH_FAMILY_NUM = 100;
const uint64_t SEEDS[HASH_FAMILY_NUM][3] = {
    {7353543920233821717u, 11965129450667059578u, 3658990609635021961u}, {12869353760577150090u, 1243148210397826328u, 2316665911052484898u}, {4615757446055505178u, 11623739807309625399u, 14541497697913070812u}, {1447664010363993770u, 1445367654967072185u, 17993243123216145813u}, {16452946607091167957u, 5882918339352931912u, 6607816765922526230u}, {2596550121147570753u, 12553096798497415263u, 9339597705568991900u}, {12945381126248547465u, 9927060733644921641u, 12351164403243812088u}, {15688981353977331589u, 12094786645259460704u, 8526144119681785396u}, {1866322276826167308u, 11412478493444048213u, 14092330155920271922u}, {14539646722974881027u, 371914660747335315u, 11632778874746677263u}, {17482447300065762123u, 2401651477287946988u, 6666178991526838933u}, {14863391041445567549u, 13509189413264099721u, 1719872221701817764u}, {10646493565828775474u, 16309229635920244031u, 1226705669354869471u}, {8385706047927987987u, 8812763802303086618u, 3772733850010166475u}, {2778434567803636376u, 17036635061618857592u, 10393105835056504868u}, {7224020355284233578u, 159517645611012911u, 8043439105564011213u}, {7271491079095577789u, 2725050895640354935u, 12616147692409931222u}, {17122147767124733988u, 16782820591624636270u, 6108289486764237432u}, {10912409218168160467u, 3061631083491277041u, 8238231033307630807u}, {3367488966012887122u, 6193380208008664263u, 10939032191521138127u}, {14085214753583657644u, 15614965298661005904u, 897043772015345956u}, {8169115975061380462u, 1602670059132748266u, 4071211539216777287u}, {10667098840697707565u, 12047501507598151528u, 16966034865198323399u}, {3629461768568669224u, 9641596315783045564u, 7298702209288284188u}, {2272307065741881146u, 5308282617171739527u, 15195280293037262343u}, {10448353070939967230u, 10543952502779360528u, 3814716204959431879u}, {6251466492678291080u, 6548988968528153824u, 11703181991288029521u}, {7934549045121814593u, 13139687000270273560u, 18105930208631254388u}, {14685167790172408575u, 5722455967766634695u, 14551380565775453064u}, {9777632340795745817u, 45605793145611237u, 1894364121677624920u}, {15466218308493836113u, 9586909028647788873u, 2047575519016398735u}, {6260844107449360961u, 17092340555384449377u, 12232061801669135922u}, {18002042419938560477u, 17379860233313552322u, 5212910023225388154u}, {4999287225424993440u, 7108971283410664441u, 13942933104106327798u}, {10465152475314457138u, 2245511109997631279u, 716564593897742502u}, {12536586122564670163u, 2508803849004444261u, 8069982198365602557u}, {14629935917131277651u, 17990214381080941348u, 16663532725577538878u}, {8343049768869892675u, 15388260875482938595u, 1231438440828569149u}, {18088531374266875816u, 15622948257503151986u, 17483603903227749162u}, {1480111670434586704u, 1021136948349942643u, 12227834344101931034u}, {16636533701593992830u, 10910756504643718034u, 8124776819058613672u}, {16221527638628166209u, 2247926983501204u, 3780150115531970592u}, {753313606553468259u, 14065936948434914395u, 2171852250322095501u}, {18143544049755172116u, 3591215901764866887u, 9708968344819037447u}, {13460181424062854712u, 18384756937014944011u, 1546599595308469637u}, {7524949717689483050u, 1416480754870060882u, 415903468166657911u}, {913834764074048338u, 10707980462610292231u, 9247222786022883704u}, {9650118834810598561u, 13438206606312533330u, 15426807741203560204u}, {13773158665555751600u, 12091657278858940196u, 14223122444352490683u}, {5855567383777871437u, 12018668955244745630u, 1775706499847480972u}, {9193668323709415570u, 17253548952934704357u, 15476572554996755111u}, {7426067317415449683u, 12469049155753162841u, 16091738328892750307u}, {12206241681755539700u, 3115849182950404879u, 11735852717893061314u}, {12982568784321407432u, 16333446857803717835u, 8151559339886816624u}, {1765934631416660951u, 14154292715278984682u, 14046044252268997452u}, {14310675766531528898u, 11184747393172936870u, 5864119742259425419u}, {5932642652417069944u, 7401129828808663679u, 2864217547663768009u}, {11792730215357576886u, 117293020319271659u, 18300741183560326176u}, {4410474212837010467u, 8118059977004473368u, 11430024008070518655u}, {1181114040728564753u, 5977746359751600102u, 2844080224411863272u}, {13912272631279610732u, 5981952720952917352u, 1785144317906245665u}, {9193764647700204369u, 17200263979685319732u, 7328818482394108468u}, {17542757439622491690u, 7809939524249497351u, 3397559829713220740u}, {16979869664270478592u, 865677232581838538u, 6080650104460444745u}, {6607768762367976520u, 12830830924501961091u, 14702195308054555399u}, {5995904524881710828u, 2927226823822749717u, 15282686899865149520u}, {15648977790415205041u, 5068894159555295389u, 18041246656736641687u}, {4381631225902134899u, 3536745698926532650u, 5890346504176380410u}, {11138358378158918600u, 2514467566487037196u, 16400314772083737338u}, {4190627244982936864u, 15347288681000373953u, 10712500968592755547u}, {4385372608399907357u, 15497364540608501096u, 15725985611312509574u}, {14919622580305431387u, 1752181902102080214u, 8326563355031911559u}, {15336670068986435203u, 18065049702179650575u, 5767357792564241761u}, {17632258244915073688u, 16481238880532254108u, 6755418558808218926u}, {9138738021201321752u, 2222536073413479774u, 16221362416631880967u}, {16130218401745128439u, 3294924921853394684u, 17610976656228675542u}, {1839713819255859999u, 1462113280061209983u, 7918862141562729407u}, {14600713176593383445u, 1092324714638445087u, 11580135117411179287u}, {17165549623789905811u, 4535800417633911407u, 14940624649227819554u}, {4811068171938414177u, 14447276704814225249u, 1187613356738886346u}, {16913179087138237218u, 15518082216763226296u, 13702350515299733589u}, {18281975312197210192u, 8131052811936731077u, 10059235887550954906u}, {8740120321182323141u, 16257659721107128346u, 8338187772321220774u}, {221824563522041403u, 16560967710135151497u, 18230837648158045710u}, {12460077699450252953u, 17298742263006203321u, 9410924416485572839u}, {14313293791723429860u, 9980879273385208763u, 14591986752234738498u}, {8869711539882854783u, 14412782066166823872u, 4733756258824060494u}, {15129159270271490587u, 12776518058644872509u, 3729677791909392420u}, {14870201316280377385u, 14892557087953872258u, 9432712294731997092u}, {13432342527115828472u, 7023558311484610821u, 13375297979518672503u}, {2054662303229553729u, 10560254745858751006u, 11699283479173708656u}, {17161861030814711007u, 667701285635134344u, 1824983418404087440u}, {6182905165306195585u, 3050069894769288144u, 4389610917767502178u}, {11350802717765225581u, 3990940288371155644u, 4956207853014608752u}, {2289707678490207834u, 6281122426822255686u, 12561190656211362169u}, {15511231355213043163u, 4911054917449140128u, 201047251395718881u}, {4977214509611334990u, 9657853413341355605u, 8592449907134304639u}, {12412415892652371668u, 1441284316931372203u, 9567308307871381825u}, {17944066347546023898u, 2838756353230375991u, 8276640253498702148u}, {13067544330552711458u, 296616875844846918u, 11441995687351449738u}, 
};

template <typename KEY_TYPE>
class HashFamily {
   public:
    HashFamily() {
        // require the size of KEY_TYPE is the times of 64 bits
        assert(sizeof(KEY_TYPE) % 8 == 0);
    }
    std::tuple<uint32_t, uint32_t, uint32_t> hash(KEY_TYPE key, int family,
                                                  int mod) {
        uint64_t h1 = SEEDS[family][0], h2 = SEEDS[family][1],
                 h3 = SEEDS[family][2];
        uint64_t *t = (uint64_t *)&key;
        for (uint32_t i = 0; i < sizeof(KEY_TYPE) / 8; i++) {
            h1 ^= t[i] + 3;
            h2 ^= t[i] + 7;
            h3 ^= t[i] + 11;
        }
        h1 %= mod;
        h2 %= mod;
        h3 %= mod;
        return std::make_tuple<uint32_t, uint32_t, uint32_t>(h1, h2, h3);
    }

    uint32_t hash_once(KEY_TYPE key, int mod) {
        uint64_t h = 12191410945815747277u;
        uint64_t *t = (uint64_t *)&key;
        for (uint32_t i = 0; i < sizeof(KEY_TYPE) / 8; i++) {
            h ^= t[i] + 23;
        }
        return h % mod;
    }
};
